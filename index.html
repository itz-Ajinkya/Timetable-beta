<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COEP Stylish Scheduler</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* Light Mode Variables */
            --bg-app: #faf9f6; /* Off-white paper look */
            --surface: #ffffff;
            --text-main: #2d3436;
            --text-sub: #636e72;
            --border-color: #e0e0e0;
            --shadow: 0 8px 20px rgba(0,0,0,0.06);
            --card-radius: 20px;
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --bg-app: #121212;
            --surface: #1e1e1e;
            --text-main: #f5f6fa;
            --text-sub: #b2bec3;
            --border-color: #333;
            --shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; transition: background 0.3s, color 0.3s, border 0.3s; }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-app);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- Header & Controls --- */
        header {
            width: 100%; max-width: 600px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 24px;
        }

        .logo { font-size: 1.5rem; font-weight: 800; letter-spacing: -0.5px; }
        .logo span { color: #6c5ce7; } /* Accent */

        .theme-toggle {
            background: var(--surface);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1.2rem;
            box-shadow: var(--shadow);
        }

        .search-container {
            width: 100%; max-width: 600px;
            display: flex; gap: 10px;
            margin-bottom: 30px;
        }

        input {
            flex: 1; padding: 14px 20px;
            border-radius: 16px; border: none;
            background: var(--surface);
            color: var(--text-main);
            font-family: inherit; font-size: 1rem;
            box-shadow: var(--shadow);
            outline: none;
        }

        button.go-btn {
            padding: 0 24px;
            background: #2d3436; color: white;
            border-radius: 16px; border: none;
            font-weight: 700; cursor: pointer;
        }
        body.dark-mode button.go-btn { background: #6c5ce7; }

        /* --- SLIDABLE SUBJECTS (Horizontal Scroll) --- */
        .slider-label {
            width: 100%; max-width: 600px;
            margin-bottom: 10px; font-weight: 600; color: var(--text-sub); font-size: 0.9rem;
            display: flex; justify-content: space-between;
        }

        .subjects-slider {
            width: 100%; max-width: 600px;
            display: flex; gap: 12px;
            overflow-x: auto;
            padding-bottom: 10px; /* Space for scrollbar hide or shadow */
            margin-bottom: 30px;
            scrollbar-width: none; /* Hide scrollbar Firefox */
        }
        .subjects-slider::-webkit-scrollbar { display: none; } /* Hide Chrome */

        .sub-box {
            min-width: 110px;
            height: 110px;
            background: var(--surface);
            border-radius: 20px;
            padding: 15px;
            display: flex; flex-direction: column; justify-content: space-between;
            box-shadow: var(--shadow);
            flex-shrink: 0;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .sub-box-code { font-weight: 800; font-size: 1.2rem; opacity: 0.9; }
        .sub-box-name { font-size: 0.75rem; opacity: 0.7; line-height: 1.2; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;}
        .sub-box-meta { font-size: 0.7rem; font-weight: 600; opacity: 0.5; margin-top: auto; }

        /* --- TIMETABLE (Vertical Agenda) --- */
        .timetable-area {
            width: 100%; max-width: 600px;
            display: flex; flex-direction: column; gap: 20px;
        }

        .day-container {
            background: var(--surface);
            border-radius: 24px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .day-header {
            font-size: 1.1rem; font-weight: 800; color: var(--text-main);
            margin-bottom: 16px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .today-badge {
            background: #6c5ce7; color: white;
            font-size: 0.7rem; padding: 4px 10px; border-radius: 20px;
            font-weight: 600; text-transform: uppercase;
        }

        .class-row {
            display: grid;
            grid-template-columns: 60px 1fr;
            gap: 15px;
            margin-bottom: 16px;
        }
        .class-row:last-child { margin-bottom: 0; }

        .time-col {
            font-size: 0.85rem; font-weight: 600; color: var(--text-sub);
            text-align: right; padding-top: 14px;
        }

        /* --- The Stylish Class Card --- */
        .class-card {
            border-radius: 18px;
            padding: 16px;
            position: relative;
            overflow: hidden;
            display: flex; justify-content: space-between; align-items: center;
            /* Faint color background set via JS */
        }

        .card-info { position: relative; z-index: 2; }
        
        /* "Shortform in big font" */
        .big-code {
            font-size: 1.8rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 4px;
            color: rgba(0,0,0,0.7); /* Always darkish text for contrast on pastel */
        }
        
        .card-type {
            font-size: 0.75rem; font-weight: 600; 
            text-transform: uppercase; opacity: 0.6; color: rgba(0,0,0,0.6);
        }

        /* "Classroom where it will be held" */
        .room-bubble {
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(4px);
            padding: 8px 12px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 0.9rem;
            color: rgba(0,0,0,0.8);
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            min-width: 60px; text-align: center;
        }

        /* Clash Styling */
        .clash-card {
            background: #ffeaa7;
            border-radius: 18px; padding: 15px;
            color: #d63031; font-weight: 700;
            border: 2px dashed #d63031;
            text-align: center;
        }

        /* Empty State */
        .empty-view {
            text-align: center; padding: 40px; color: var(--text-sub);
        }

    </style>
</head>
<body>

    <header>
        <div class="logo">üìÖ <span>COEP</span></div>
        <button class="theme-toggle" onclick="toggleTheme()">üåó</button>
    </header>

    <div class="search-container">
        <input type="tel" id="misInput" placeholder="Enter MIS (e.g. 612515003)" onkeypress="handleEnter(event)">
        <button class="go-btn" onclick="renderTimetable()">GO</button>
    </div>

    <div id="subjectArea" style="display:none; width: 100%; max-width: 600px;">
        <div class="slider-label">
            <span>Your Subjects</span>
            <span style="opacity:0.5;">Scroll ‚û°</span>
        </div>
        <div class="subjects-slider" id="subjectsSlider">
            </div>
    </div>

    <div id="timetableArea" class="timetable-area">
        <div class="empty-view">
            <div style="font-size:3rem; margin-bottom:10px;">‚ú®</div>
            Enter your MIS ID to view<br>your stylish agenda.
        </div>
    </div>

    <script src="students.js"></script>
    <script src="logic.js"></script>

    <script>
        const TIME_SLOTS = [
            { key: "0830", label: "08:30" }, { key: "0930", label: "09:30" },
            { key: "1030", label: "10:30" }, { key: "1130", label: "11:30" },
            { key: "1230", label: "12:30" }, { key: "1330", label: "01:30" },
            { key: "1430", label: "02:30" }, { key: "1530", label: "03:30" },
            { key: "1630", label: "04:30" }, { key: "1730", label: "05:30" }
        ];

        const DAYS = ["mon", "tue", "wed", "thu", "fri", "sat"];
        const DAY_NAMES = { mon: "Monday", tue: "Tuesday", wed: "Wednesday", thu: "Thursday", fri: "Friday", sat: "Saturday" };

        // --- FAINT/PASTEL COLOR GENERATOR ---
        function getPastelColor(code) {
            if (!code) return "#dfe6e9";
            let hash = 0;
            for (let i = 0; i < code.length; i++) hash = code.charCodeAt(i) + ((hash << 5) - hash);
            
            // Hue: Any
            // Saturation: 70-90% (Vibrant but soft)
            // Lightness: 85-93% (Very light/Faint)
            const h = Math.abs(hash % 360);
            const s = 85; 
            const l = 90; 
            return `hsl(${h}, ${s}%, ${l}%)`;
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }

        function handleEnter(e) { if(e.key === 'Enter') renderTimetable(); }

        function renderTimetable() {
            const mis = document.getElementById('misInput').value.trim();
            if(!mis) return alert("Please enter MIS ID");
            
            if(typeof getStudentData !== 'function') return alert("Error: logic.js missing");
            const data = getStudentData(mis);
            if(!data) return alert("Student not found");

            document.getElementById('subjectArea').style.display = 'block';
            const subjectSlider = document.getElementById('subjectsSlider');
            const timeline = document.getElementById('timetableArea');
            
            // --- 1. RENDER SLIDABLE SUBJECTS ---
            subjectSlider.innerHTML = "";
            if(data.cards) {
                data.cards.forEach(c => {
                    const bg = getPastelColor(c.code);
                    const div = document.createElement('div');
                    div.className = 'sub-box';
                    div.style.background = bg;
                    
                    // Division & Batch formatting
                    let meta = `Div ${c.div}`;
                    if(c.batch && c.batch !== '-') meta += ` | ${c.batch}`;

                    div.innerHTML = `
                        <div class="sub-box-code" style="color:rgba(0,0,0,0.7)">${c.code}</div>
                        <div class="sub-box-name" style="color:rgba(0,0,0,0.6)">${c.name}</div>
                        <div class="sub-box-meta" style="color:rgba(0,0,0,0.5)">${meta}</div>
                    `;
                    subjectSlider.appendChild(div);
                });
            }

            // --- 2. RENDER VERTICAL TIMETABLE ---
            timeline.innerHTML = "";
            const todayIdx = new Date().getDay(); // 0=Sun

            DAYS.forEach((day, dIdx) => {
                const dayContainer = document.createElement('div');
                dayContainer.className = 'day-container';
                
                // Day Header
                const isToday = (dIdx + 1) === todayIdx;
                dayContainer.innerHTML = `
                    <div class="day-header">
                        <span>${DAY_NAMES[day]}</span>
                        ${isToday ? '<span class="today-badge">TODAY</span>' : ''}
                    </div>
                `;

                let hasClass = false;

                // Loop Time Slots
                TIME_SLOTS.forEach(slot => {
                    const key = `${day}-${slot.key}`;
                    const entry = data.schedule[key];

                    if(entry) {
                        hasClass = true;
                        const entries = Array.isArray(entry) ? entry : [entry];

                        // Row Container
                        const row = document.createElement('div');
                        row.className = 'class-row';
                        
                        // Left: Time
                        row.innerHTML = `<div class="time-col">${slot.label}</div>`;
                        
                        // Right: Card(s)
                        const contentCol = document.createElement('div');
                        contentCol.style.flex = "1";

                        if(entries.length > 1) {
                            // Clash
                            const codes = entries.map(e => e.subj).join(' / ');
                            contentCol.innerHTML = `
                                <div class="clash-card">
                                    <div>‚ö†Ô∏è Clash</div>
                                    <div style="font-size:0.8rem; margin-top:4px;">${codes}</div>
                                </div>
                            `;
                        } else {
                            // Single Class
                            const e = entries[0];
                            const bg = getPastelColor(e.subj);
                            
                            // Check for LAB type
                            const isLab = e.type === 'lab';
                            const displayCode = isLab ? e.subj + " (L)" : e.subj;

                            contentCol.innerHTML = `
                                <div class="class-card" style="background:${bg}">
                                    <div class="card-info">
                                        <div class="big-code">${displayCode}</div>
                                        <div class="card-type">${isLab ? 'Laboratory' : 'Lecture'}</div>
                                    </div>
                                    <div class="room-bubble">${e.room}</div>
                                </div>
                            `;
                        }
                        
                        row.appendChild(contentCol);
                        dayContainer.appendChild(row);
                    }
                });

                // If day has classes, append to timeline
                if(hasClass) {
                    timeline.appendChild(dayContainer);
                } else if (isToday) {
                    // Show "No classes" only if it's today
                    const empty = document.createElement('div');
                    empty.className = 'day-container';
                    empty.innerHTML = `<div class="day-header"><span>${DAY_NAMES[day]}</span><span class="today-badge">TODAY</span></div><div style="text-align:center; opacity:0.5; padding:20px;">No classes today! üéâ</div>`;
                    timeline.appendChild(empty);
                }
            });
            
            // Scroll to today if possible (simple implementation)
            // const todayEl = document.querySelector('.today-badge');
            // if(todayEl) todayEl.scrollIntoView({behavior: 'smooth', block: 'center'});
        }
    </script>
</body>
</html>
